## ‚òÅÔ∏è EKS GitOps Configuration Repository (`liormilliger/cloudride-k8s.git`)

This repository contains the full set of Kubernetes manifests and ArgoCD Application definitions for deploying a production-ready application environment on an EKS cluster.

It operates under the **GitOps principle**, where all desired cluster states are defined here as code and managed by an ArgoCD instance running on the cluster.

### üîë Prerequisites

Before utilizing this repository, the underlying infrastructure must be provisioned.

* **EKS Cluster and ArgoCD:** Must be deployed using the companion **Terraform repository**: `liormilliger/cloudride-app.git`.
* **AWS Secrets Manager Credentials:** RDS credentials (username/password) are expected to exist in AWS Secrets Manager under the key `rds!db-ef76ec0b-780c-4e4b-a8d6-45d22333ed19`.
* **ACM Certificate:** An AWS ACM certificate with the ARN `arn:aws:acm:us-west-2:753392824297:certificate/cadf964f-0be5-43da-a1c7-2f5ba2b386a6` must exist in the `us-west-2` region for the Ingress to function with HTTPS.

### üèóÔ∏è Architecture & Deployment Flow

The entire cluster state is managed via the **App of Apps** pattern, with `sync-wave` annotations controlling the deployment order:

| Component | Sync Wave | Purpose | Sources |
| :--- | :--- | :--- | :--- |
| **Prometheus CRDs** | `-1` | Ensures Custom Resource Definitions are created first (Server Side Applied). | `prom-crd.yaml` |
| **ECK Operator** | `1` | Deploys the Elastic Cloud on Kubernetes Operator. | `eck-operator.yaml` |
| **AWS ALB Controller** | *(None specified)* | Manages AWS Load Balancers via Kubernetes Ingress resources. | `alb-controller.yaml` |
| **External Secrets** | *(None specified)* | The `ClusterSecretStore` and `ExternalSecret` integrate with AWS Secrets Manager. | `cluster-secret-store.yaml`, `rds-external-secret.yaml` |
| **EKS StorageClass** | *(None specified)* | Sets the default storage class to `gp3`. | `storage-class.yaml` |
| **Elastic Stack (ECK)** | `2` | Deploys Elasticsearch and Kibana (managed by the Operator). | `eck-stack.yaml` |
| **Filebeat** | `2` | Deploys Filebeat as a DaemonSet to send logs to the Elastic Stack. | `filebeat-eck.yaml` |
| **Prometheus Stack** | *(None specified)* | Deploys Prometheus, Alertmanager, and Grafana (components only). | `prometheus.yaml` |
| **Website Application** | `3` | Deploys the custom application, Service, and Ingress. | `my-website-app.yaml`, `my-app-chart/` |

### üåê Website Application Details

The primary application is deployed via the **`my-app-chart`** with the following key features:

* **Database Connectivity:** The application connects to an external RDS instance via an `ExternalName` service named `pgdb`.
* **Secure Credentials:** Database username and password are dynamically pulled from the Kubernetes secret `rds-credentials-k8s`, which is generated by the External Secrets Operator based on the AWS Secrets Manager entry.
* **Ingress:** The application is exposed via an AWS Application Load Balancer (ALB) Ingress, listening on HTTP (80) and HTTPS (443) for the hostname **`cloudride-app.ddns.net`**.

### ‚öôÔ∏è Access and Operations

After deployment, refer to the **`NOTES.txt`** file generated by the application Helm chart for essential post-deployment instructions on how to access the various services like ArgoCD, Grafana, and Kibana, and how to configure DNS.